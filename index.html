<!DOCTYPE html>
<html>
<head>
	<title>Penny Farthing</title>
	<style type="text/css">
		html,body {
			background-color: #333;
			color: #fff;
			font-family: helvetica, arial, sans-serif;
			margin: 0;
			padding: 0;
			font-size: 12pt;
		}
		
		#canvas {
			/*position: absolute;*/
			/*left: 0;*/
			/*right: 0;*/
			/*top: 0;*/
			/*bottom: 0;*/
			/*margin: auto;*/
		}

        .letter-obtained,
        .letter-selected {
            padding: 10px;
        }

        .letter-obtained:hover,
        .letter-selected:hover {
            cursor: pointer;
        }
	</style>

</head>
<body>
    <div id="main">
        <div id="tray"></div>
	    <canvas id="canvas"></canvas>
        <div id="word">
            <div id="selection">

            </div>
            <button name="check" onclick="checkAnswer()">Check</button>
        </div>
        <div id="inventory">
        </div>
        <div id="game"></div>
        <div id="dialog">
            <table width='540'>
                <tr>
                    <td width="50">
                        Penny<br />
                        <img src="http://placekitten.com/30/30" />
                    </td>
                    <td width="220">
                        <div id="penny"></div>
                    </td>
                    <td width="220">
                        <div id="mum"></div>
                    </td>
                    <td width="50">
                        Mum<br />
                        <img src="http://placekitten.com/30/30" />
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>
<script type="text/javascript" src="jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="dialogdata.js"></script>
<script>
    var wordEl = $('#word #selection');
    var trayEl = $('#tray');
    var dialogsLaunched = {};

    // Main Program
    $(function() {


        $('#main').on('letter-obtain', function(e, letter){
            console.log('letter obtaned!!');
            console.log('I got ', letter);

            trayEl.append('<span class="letter-obtained">'+letter+'</span>');

            $('span.letter-obtained').each(function( index ){
                $(this).unbind('click');
                $(this).on('click', function(){
                    var letterSet = $(this).text();
                    wordEl.append('<a class="letter-selected" onClick="removeLetterObtained(this);">'+letterSet+'</span>')
                    $(this).remove();
                });
            });

        });

        $('#main').on('dialog', function(e, dialogId){
            if ( ! dialogData.hasOwnProperty(dialogId) || dialogsLaunched.hasOwnProperty(dialogId) ) {
                return;
            }

            console.log('dialog', dialogId, dialogData[dialogId]);

            dialogsLaunched[dialogId] = true;

            var scene = dialogData[dialogId];

            var i = 0;
            var speech = scene[i];
            addSpeech(speech, i, scene);

        });

    });

    function addSpeech(speech, i, scene) {
        console.log('speech', speech.dialog);
        var dataEl = '<div id="speech-'+speech.character+'" class="speech">'+speech.dialog+'</div>';

        console.log(i, speech.character);
        $('#'+speech.character).append(dataEl);
        $('#speech-'+speech.character).fadeOut(speech.delay, function(){
            $('#'+speech.character).html('');
            i++;
            if (i >= scene.length) {
                return;
            }

            speech = scene[i];
            addSpeech(speech, i, scene);
        });
    }

    function removeLetterObtained(el) {
        var letterRemove = $(el).text();
        trayEl.append('<span class="letter-obtained">'+letterRemove+'</span>');


        $('span.letter-obtained').each(function( index ){
            $(this).unbind('click');
            $(this).on('click', function(){
                var letterSet = $(this).text();
                wordEl.append('<a class="letter-selected" onClick="removeLetterObtained(this);">'+letterSet+'</span>')
                $(this).remove();
            });
        });

        $(el).remove();
    }

    function checkAnswer() {
        var theWord = '';
        $('#selection a').each(function( index ){
            theWord = theWord + $(this).text();
        });

        alert(theWord);
        theWord = '';
    }

</script>
<script type="text/javascript" src="lib/impact/impact.js"></script>
<script type="text/javascript" src="lib/game/main.js"></script>
</html>
